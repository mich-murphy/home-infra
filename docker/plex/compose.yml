---
services:
  # NOTE: visit https://<server-ip>:32400/web to setup new server
  plex:
    image: plexinc/pms-docker:1.43.0.10492-121068a07@sha256:1131c4cd21fa22f8196f749f1dbb69af306776c3c83c7f5b061e51dc49bcff7f
    container_name: plex
    security_opt:
      - no-new-privileges:true
    networks:
      - proxy
    devices:
      - /dev/dri:/dev/dri
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=${TZ}
      - PLEX_CLAIM=${PLEX_CLAIM}
    volumes:
      - plex-data:/config
      - /mnt/data/media:/data/media:rw
      - /mnt/music:/data/music:rw
      - /dev/shm:/transcode # ram transcode
    labels:
      - traefik.enable=true
      - traefik.http.routers.plex.rule=Host(`plex.local.elmurphy.com`)
      - traefik.http.routers.plex.tls=true
      - traefik.http.services.plex.loadbalancer.server.port=32400
    restart: unless-stopped

  tautulli:
    image: ghcr.io/linuxserver/tautulli:v2.16.1-ls217@sha256:9d4cd2f0342d4a2e31f4bcf22d9acad1b2e13fc5997a55ceec11344d699c0976
    container_name: tautulli
    security_opt:
      - no-new-privileges:true
    networks:
      - proxy
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=${TZ}
    volumes:
      - tautulli-data:/config
    labels:
      - traefik.enable=true
      - traefik.http.routers.tautulli.rule=Host(`tautulli.local.elmurphy.com`)
      - traefik.http.routers.tautulli.tls=true
      - traefik.http.services.tautulli.loadbalancer.server.port=8181
    restart: unless-stopped

  overseerr:
    image: ghcr.io/linuxserver/overseerr:v1.34.0-ls156@sha256:987a6bd200a88501a5fa0cfa0c3179acd83e5b0af986da1537b70f44cfe059b8
    container_name: overseerr
    security_opt:
      - no-new-privileges:true
    networks:
      - proxy
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=${TZ}
    volumes:
      - overseerr-data:/config
    labels:
      - traefik.enable=true
      - traefik.http.routers.overseerr.rule=Host(`overseerr.local.elmurphy.com`)
      - traefik.http.routers.overseerr.tls=true
      - traefik.http.services.overseerr.loadbalancer.server.port=5055
    restart: unless-stopped

  maintainerr:
    image: ghcr.io/maintainerr/maintainerr:2.27.0@sha256:4d07ffaf673f7703bcead8e67f2a9f4fbd5e6bb4d43e4c7c8f81bb45844c8e1b
    container_name: maintainerr
    security_opt:
      - no-new-privileges:true
    user: 1000:1000
    networks:
      - proxy
    environment:
      - TZ=${TZ}
    volumes:
      - maintainerr-data:/opt/data
    labels:
      - traefik.enable=true
      - traefik.http.routers.maintainerr.rule=Host(`maintainerr.local.elmurphy.com`)
      - traefik.http.routers.maintainerr.tls=true
      - traefik.http.services.maintainerr.loadbalancer.server.port=6246
    restart: unless-stopped

  # Manually setup initial config
  # Reference: https://kometa.wiki/en/latest/kometa/install/walkthroughs/docker/#setting-up-the-initial-config-file
  kometa:
    image: kometateam/kometa:v2.3.0@sha256:340e4176e1d75f04d2b55ce177326710f28770b5f56537fd539a034b143fe66d
    container_name: kometa
    security_opt:
      - no-new-privileges:true
    networks:
      - proxy
    volumes:
      - kometa-data:/config:rw
    restart: unless-stopped

volumes:
  plex-data:
    name: plex-data
  tautulli-data:
    name: tautulli-data
  overseerr-data:
    name: overseerr-data
  maintainerr-data:
    name: maintainerr-data
  kometa-data:
    name: kometa-data

networks:
  proxy:
    external: true
